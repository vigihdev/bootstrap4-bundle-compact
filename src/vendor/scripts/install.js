#!/usr/bin/env node
// install.js

const fs = require('fs');
const path = require('path');
const { cwd } = require('process');

const dstPath = path.resolve(cwd(), 'src', 'assets', 'parent-themes-styles');
const dstFilePath = path.join(dstPath, '_index.scss');
const srcPath = path.resolve(cwd(), '..', '..', '..', 'node_modules', 'bootstrap', 'scss');

function pathValidate(filepath) {
    return filepath && fs.existsSync(filepath)
}

const isNotValids = [dstPath, dstFilePath, srcPath].filter(p => !pathValidate(p))
if (isNotValids && isNotValids?.length === 0) {
    const relativePath = path.relative(dstPath, srcPath);
    const content = [
        '// index.scss',
        '',
        '// Generated by Command',
        `// Timestamp: ${new Date().toISOString()}`,
        '',
        `@import "${relativePath}/mixins";`,
        `@import "${relativePath}/functions";`,
        `@import "${relativePath}/variables";`,
        ''
    ].join('\n');

    try {
        fs.writeFileSync(dstFilePath, content, 'utf8');
        console.log(`✅ File berhasil disimpan: ${dstFilePath}`);
        return true;
    } catch (error) {
        console.error(`❌ Gagal menyimpan file: ${error.message}`);
        return false;
    }
}
// /Users/thrubus/VigihDev/NpmPackage/test-paket/node_modules/bootstrap/scss/mixins/_size.scss

// Remove Deprace
const fileSizeScss = path.resolve(process.env.PWD, 'node_modules', 'bootstrap', 'scss', 'mixins', '_size.scss');
// const fileSizeScss = path.resolve(cwd(), '..', '..', '..', 'node_modules', 'bootstrap', 'scss', 'mixins', '_size.scss');
if (fs.existsSync(fileSizeScss)) {
    try {
        let content = fs.readFileSync(fileSizeScss, 'utf8');

        // Regex untuk hapus @include deprecate yang spesifik untuk size()
        const regex = /@include deprecate\("`size\(\)`", "v4\.3\.0", "v5"\);\s*/g;

        const newContent = content.replace(regex, '');

        if (content !== newContent) {
            fs.writeFileSync(filePath, newContent, 'utf8');
            console.log(`✅ Updated: ${filePath}`);
        } else {
            console.log(`⏩ No changes: ${filePath}`);
        }
        return true;
    } catch (error) {
        // console.error(`❌ Error processing ${filePath}:`, error.message);
        return true;
    }
}