#!/usr/bin/env node
// install.js

const { spawnSync } = require('child_process');
const fs = require('fs');
const path = require('path');
const { cwd } = require('process');

const dstPath = path.resolve(cwd(), 'src', 'assets', 'parent-themes-styles');
const dstFilePath = path.join(dstPath, '_index.scss');
const srcPath = path.resolve(cwd(), '..', '..', '..', 'node_modules', 'bootstrap', 'scss');

function pathValidate(filepath) {
    return filepath && fs.existsSync(filepath)
}

const isNotValids = [dstPath, dstFilePath, srcPath].filter(p => !pathValidate(p))
if (isNotValids && isNotValids?.length === 0) {
    const relativePath = path.relative(dstPath, srcPath);
    const content = [
        '// index.scss',
        '',
        '// Generated by Command',
        `// Timestamp: ${new Date().toISOString()}`,
        '',
        `@import "${relativePath}/mixins";`,
        `@import "${relativePath}/functions";`,
        `@import "${relativePath}/variables";`,
        ''
    ].join('\n');

    try {
        fs.writeFileSync(dstFilePath, content, 'utf8');
        console.log(`✅ File berhasil disimpan: ${dstFilePath}`);
        return true;
    } catch (error) {
        console.error(`❌ Gagal menyimpan file: ${error.message}`);
        return true;
    }
}
// /Users/thrubus/VigihDev/NpmPackage/test-paket/node_modules/bootstrap/scss/mixins/_size.scss

// Remove Deprace
const fileSizeScss = path.resolve(process.env.PWD, 'node_modules', 'bootstrap', 'scss', 'mixins', '_size.scss');
const fileSizeScssCWD = path.resolve(cwd(), '..', '..', '..', 'node_modules', 'bootstrap', 'scss', 'mixins', '_size.scss');

spawnSync('touch', ['-tmp-install'], { stdio: 'inherit' });
if (fs.existsSync('-tmp-install')) {
    fs.writeFileSync('-tmp-install', JSON.stringify({
        basepath: path.resolve('-tmp-install', '..'),
    }));

}